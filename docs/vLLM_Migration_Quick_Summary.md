# üöÄ vLLM Migration - –ö—Ä–∞—Ç–∫–æ–µ —Ä–µ–∑—é–º–µ

**GPU:** RTX 5080 (16GB VRAM, Blackwell sm_120)  
**–î–∞—Ç–∞:** 07.11.2025

---

## ‚úÖ –ß–¢–û –£–ñ–ï –†–ê–ë–û–¢–ê–ï–¢

**–¢–µ–∫—É—â–∞—è —Å–∏—Å—Ç–µ–º–∞ (Transformers API):**
- ‚úÖ PyTorch 2.9.0+cu128 + flash-attn 2.7.3
- ‚úÖ FastAPI –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å (–ø–æ—Ä—Ç 8000)
- ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω: 253 —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∑–∞ 7.6 –º–∏–Ω—É—Ç (~33 —Å—Ç—Ä/–º–∏–Ω)
- ‚úÖ –ö–∞—á–µ—Å—Ç–≤–æ: –æ—Ç–ª–∏—á–Ω–æ–µ (95% compression ratio)

**–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:**
| –ó–∞–¥–∞—á–∞ | –í—Ä–µ–º—è |
|--------|-------|
| 1 —Å—Ç—Ä–∞–Ω–∏—Ü–∞ (BPMN) | 31 —Å–µ–∫ |
| 10 —Å—Ç—Ä–∞–Ω–∏—Ü | 4-6 –º–∏–Ω—É—Ç |
| 253 —Å—Ç—Ä–∞–Ω–∏—Ü—ã | 7.6 –º–∏–Ω—É—Ç |

---

## üéØ –ó–ê–ß–ï–ú –ü–ï–†–ï–•–û–î–ò–¢–¨ –ù–ê vLLM?

**–£—Å–∫–æ—Ä–µ–Ω–∏–µ –¥–ª—è –±–æ–ª—å—à–∏—Ö –æ–±—ä–µ–º–æ–≤:**
- üìä **10 —Å—Ç—Ä–∞–Ω–∏—Ü:** 4-6 –º–∏–Ω ‚Üí 10-15 —Å–µ–∫ (—É—Å–∫–æ—Ä–µ–Ω–∏–µ 20-40x)
- üìä **100 —Å—Ç—Ä–∞–Ω–∏—Ü:** 30-50 –º–∏–Ω ‚Üí 5-10 –º–∏–Ω (—É—Å–∫–æ—Ä–µ–Ω–∏–µ 3-10x)
- üöÄ **Batch processing:** 50-100 —Å—Ç—Ä–∞–Ω–∏—Ü –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ

**–ù–æ:**
- ‚ö†Ô∏è **1 —Å—Ç—Ä–∞–Ω–∏—Ü–∞:** 31 —Å–µ–∫ ‚Üí 30-35 —Å–µ–∫ (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
- ‚ö†Ô∏è **–°–ª–æ–∂–Ω–æ—Å—Ç—å —É—Å—Ç–∞–Ω–æ–≤–∫–∏:** 4-8 —á–∞—Å–æ–≤
- ‚ö†Ô∏è **–ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã –≤–µ—Ä—Å–∏–π:** transformers 4.46.3 ‚Üí 4.51.1

---

## üéØ –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–Ø

### ‚úÖ –ü–ï–†–ï–ô–¢–ò –ù–ê vLLM –ö–û–ì–î–ê:

1. **–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç–µ >50 PDF –≤ –¥–µ–Ω—å**
   - –≠–∫–æ–Ω–æ–º–∏—è: 4-6 —á–∞—Å–æ–≤ –≤ –¥–µ–Ω—å

2. **–¢—Ä–µ–±—É–µ—Ç—Å—è batch processing**
   - –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ 10-50 —Å—Ç—Ä–∞–Ω–∏—Ü

3. **Production environment**
   - –í—ã—Å–æ–∫–∏–π throughput
   - –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å

### ‚ö†Ô∏è –û–°–¢–ê–¢–¨–°–Ø –ù–ê TRANSFORMERS –ï–°–õ–ò:

1. **–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç–µ <10 PDF –≤ –¥–µ–Ω—å**
   - –¢–µ–∫—É—â–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–∞
   - –ü—Ä–æ—Å—Ç–æ—Ç–∞ –∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å

2. **–í–∞–∂–Ω–∞ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å**
   - –°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∞
   - –ù–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –≤–µ—Ä—Å–∏–π

3. **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è**
   - –£—Å—Ç–∞–Ω–æ–≤–∫–∞ vLLM: 4-8 —á–∞—Å–æ–≤

---

## üìã –£–°–¢–ê–ù–û–í–ö–ê vLLM (–µ—Å–ª–∏ —Ä–µ—à–∏–ª–∏—Å—å)

### –í–∞—Ä–∏–∞–Ω—Ç 1: Upstream (–†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø)

```bash
cd /home/budnik_an/Obligations
source DeepSeek-OCR/venv/bin/activate
pip install vllm --pre --extra-index-url https://wheels.vllm.ai/nightly
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –°—Ç–∞–±–∏–ª—å–Ω–∞—è 0.8.5

```bash
wget https://github.com/vllm-project/vllm/releases/download/v0.8.5/vllm-0.8.5+cu118-cp310-cp310-manylinux1_x86_64.whl
pip install vllm-0.8.5+cu118-cp310-cp310-manylinux1_x86_64.whl
```

---

## üõ†Ô∏è –ù–ê–°–¢–†–û–ô–ö–ê

### 1. –û–±–Ω–æ–≤–∏—Ç—å config.py

**–§–∞–π–ª:** `DeepSeek-OCR/DeepSeek-OCR-master/DeepSeek-OCR-vllm/config.py`

```python
# RTX 5080 (16GB VRAM)
MAX_CONCURRENCY = 50
BASE_SIZE = 1024
IMAGE_SIZE = 1024
CROP_MODE = False

# –õ–æ–∫–∞–ª—å–Ω–∞—è –º–æ–¥–µ–ª—å
MODEL_PATH = '/home/budnik_an/.cache/huggingface/hub/models--deepseek-ai--DeepSeek-OCR/...'

# –ü—É—Ç–∏
INPUT_PATH = '/home/budnik_an/Obligations/input/–î–ü-–ë6.001-07 (–≠—Ç–∞–ª–æ–Ω 2 –¥–ª—è –æ–∑–Ω–∞–∫–æ–º–ª–µ–Ω–∏—è).pdf'
OUTPUT_PATH = '/home/budnik_an/Obligations/output_vllm/'
```

### 2. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç

```bash
cd /home/budnik_an/Obligations/DeepSeek-OCR/DeepSeek-OCR-master/DeepSeek-OCR-vllm
python run_dpsk_ocr_pdf.py
```

---

## ‚ö†Ô∏è –ò–ó–í–ï–°–¢–ù–´–ï –ü–†–û–ë–õ–ï–ú–´

### –ü—Ä–æ–±–ª–µ–º–∞ 1: –ö–æ–Ω—Ñ–ª–∏–∫—Ç transformers

```bash
# –†–µ—à–µ–Ω–∏–µ:
pip install transformers==4.51.1
```

### –ü—Ä–æ–±–ª–µ–º–∞ 2: Triton errors

```bash
# –†–µ—à–µ–Ω–∏–µ:
export TRITON_PTXAS_PATH="/usr/local/cuda-12.8/bin/ptxas"
export VLLM_USE_V1=0
```

---

## üí° –ò–¢–û–ì

**–î–ª—è —Ç–µ–∫—É—â–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞:**
- ‚úÖ **Transformers —Å–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –æ—Ç–ª–∏—á–Ω–æ**
- ‚úÖ **–°–∫–æ—Ä–æ—Å—Ç—å 30-40 —Å—Ç—Ä/–º–∏–Ω –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–∞**
- ‚ö†Ô∏è **vLLM –¥–∞—Å—Ç 3-4x —É—Å–∫–æ—Ä–µ–Ω–∏–µ** –¥–ª—è –±–æ–ª—å—à–∏—Ö –æ–±—ä–µ–º–æ–≤
- ‚ö†Ô∏è **–ù–æ —Ç—Ä–µ–±—É–µ—Ç 4-8 —á–∞—Å–æ–≤ –Ω–∞ —É—Å—Ç–∞–Ω–æ–≤–∫—É –∏ –æ—Ç–ª–∞–¥–∫—É**

**–ú–æ–π —Å–æ–≤–µ—Ç:**
1. **–û—Å—Ç–∞—Ç—å—Å—è –Ω–∞ Transformers** –ø–æ–∫–∞ –Ω–µ –≤–æ–∑–Ω–∏–∫–Ω–µ—Ç —Ä–µ–∞–ª—å–Ω–æ–π –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–∏
2. **–ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ vLLM** –∫–æ–≥–¥–∞ –æ–±—ä–µ–º –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø—Ä–µ–≤—ã—Å–∏—Ç 50 PDF/–¥–µ–Ω—å
3. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å vLLM** –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º venv –ø–µ—Ä–µ–¥ –º–∏–≥—Ä–∞—Ü–∏–µ–π

---

üìÑ **–ü–æ–ª–Ω—ã–π –∞–Ω–∞–ª–∏–∑:** `docs/vLLM_Migration_Analysis.md`  
üìä **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** Transformers: 33 —Å—Ç—Ä/–º–∏–Ω, vLLM: 85-125 —Å—Ç—Ä/–º–∏–Ω (batch)  
üéØ **–°—Ç–∞—Ç—É—Å:** Transformers —Ä–∞–±–æ—Ç–∞–µ—Ç –æ—Ç–ª–∏—á–Ω–æ, vLLM - –æ–ø—Ü–∏—è –¥–ª—è –±—É–¥—É—â–µ–≥–æ
