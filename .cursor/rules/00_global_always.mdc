---
description: Global project rules (always applied)
globs:
  - "**/*"
alwaysApply: true
---

# Глобальные правила проекта

## Основная цель проекта

Автоматизированная обработка текстов, таблиц и схем для построения BPMN схем бизнес-процессов, совместимых с Camunda Modeler. Развитие в сторону Graph RAG с интеллектуальным поиском по базе знаний.

## Единый источник правил

- **Единственный источник истины по правилам — `.cursor/rules/*.mdc` (модульно).**
- Дублирование правил в других местах **запрещено** (неизбежен дрейф и конфликт требований).
- `project.mdc` — только обвязка для авто-применения, не содержит копии правил.

## Принципы разработки

### Архитектурный подход

**ВСЕГДА перед началом кодирования:**

1. **Провести анализ архитектуры решения:**
   - Определить компоненты и модули системы
   - Выявить зависимости и интерфейсы
   - Оценить сложность и риски
   - Предложить варианты реализации

2. **Согласовать с пользователем:**
   - Представить архитектурное решение
   - Обосновать выбор подхода
   - Получить подтверждение перед кодированием

3. **Только после согласования приступать к реализации**

> **Код БЕЗ предварительного согласования архитектуры — ЗАПРЕЩЁН** для задач с изменением структуры/алгоритмов.

### Формат представления архитектуры

```markdown
АРХИТЕКТУРНЫЙ АНАЛИЗ

## Задача
[Описание задачи своими словами]

## Предлагаемая архитектура

### Компоненты:
1. [Компонент 1]
   - Ответственность: [...]
   - Интерфейс: [...]

### Схема взаимодействия:
[Текстовая или ASCII схема]

### Применение принципов:
- SOLID: [как применяется]
- KISS: [как соблюдается простота]
- DRY: [как избегается дублирование]

### Альтернативные варианты:
1. [Вариант 1] - [плюсы/минусы]

### Рекомендация:
[Обоснованный выбор подхода]

## Требуется ваше согласие для начала реализации
```

### SOLID / DRY / KISS

- **S** (Single Responsibility) — один класс/модуль = одна ответственность.
- **O** (Open/Closed) — открыт для расширения, закрыт для модификации.
- **L** (Liskov Substitution) — подтипы должны заменять базовые типы.
- **I** (Interface Segregation) — много специализированных интерфейсов лучше одного общего.
- **D** (Dependency Inversion) — зависимость от абстракций, а не от конкретных реализаций.
- **DRY** — избегать дублирования кода; выносить общую логику в утилиты.
- **KISS** — простые решения предпочтительнее сложных; не усложнять без необходимости.

## Методология BPM

### Уровень экспертизы

**ВСЕГДА работать на уровне МИРОВОГО ЭКСПЕРТА по процессному моделированию:**
- Применять лучшие практики BPMN 2.0 и нотации моделирования
- Использовать методологии BPM (Business Process Management)
- Следовать стандартам OMG (Object Management Group)
- Учитывать принципы Six Sigma, Lean, ITIL при анализе процессов
- Применять паттерны workflow и best practices индустрии

## Общие правила работы

### Язык коммуникации
- Всегда отвечать на русском языке
- Использовать профессиональную терминологию в области BPM
- Пояснять технические термины при первом упоминании

### Стиль работы
- **Архитектурный подход**: всегда начинать с анализа и согласования решения
- **SOLID/KISS/DRY**: применять принципы качественной разработки
- Действовать проактивно ТОЛЬКО после согласования архитектуры
- Создавать резервные копии в папке `archive/` перед значительными изменениями
- Документировать все изменения и решения
- **Вести Changelog**: фиксировать все значимые изменения в `Changelog.md`
- **НЕ делать git коммиты**: пользователь делает коммиты самостоятельно

### Работа с документацией

**Архитектура документации проекта:**
- `README.md` — главная точка входа, навигация
- `Changelog.md` — история изменений
- `docs/Architecture.md` — техническая архитектура
- `docs/BPMN_Elements_Reference.md` — полный справочник BPMN 2.0
- `docs/DeepSeek_OCR_Guide.md` — инструкции по установке OCR
- `docs/CURSOR_AI_TOOLS_GUIDE.md` — руководство по инструментам Cursor AI
- `docs/Roadmap_GraphRAG.md` — план развития: Graph RAG и VLM
- `.cursor/rules/` — модульные правила работы

**ПРАВИЛА:**
1. **ЗАПРЕЩЕНО создавать MD файлы без ЯВНОЙ команды пользователя**
   - Отчеты, статусы, summary, guides, recommendations, findings — НЕТ!
   - ВСЕ выводы, анализы, результаты -> **В ЧАТ**
   - MD файлы ТОЛЬКО когда пользователь ЯВНО скажет "создай MD файл" или "задокументируй в файле"
   - Важная информация -> `Changelog.md` (по окончании работы)

2. **Архитектуру документации менять ТОЛЬКО:**
   - При обнаружении пробела в документации
   - С явного разрешения пользователя
   - После согласования структуры

3. **Исключения (часть методологии работы с процессами):**
   - `output/[Процесс]/[Процесс]_OCR.md` — расшифровка документа
   - `output/[Процесс]/[Процесс]_RACI.md` — матрица ответственности
   - `output/[Процесс]/[Процесс]_Pipeline.md` — текстовый пайплайн
   - `output/[Процесс]/[Процесс].bpmn` — BPMN диаграмма
   - `output/[Процесс]/[Процесс].md` — документация процесса

**ФОРМАТ ВЫВОДА:**
- По умолчанию: весь анализ, выводы, рекомендации -> в чат
- MD файлы: только по явной команде пользователя
- Changelog: обновлять в конце работы над задачей

### Ведение Changelog

**ОБЯЗАТЕЛЬНО обновлять файл `Changelog.md` при каждом значимом изменении проекта.**

#### Формат записи:

```markdown
## [DD-MM-YYYY] - Краткое описание изменений

### Добавлено
- Описание новых функций

### Изменено
- Описание модификаций

### Исправлено
- Описание исправленных ошибок
```

#### Правила:
1. Дата в формате `DD-MM-YYYY`
2. Порядок записей: от новых к старым
3. Детальность: достаточно для понимания сути

#### ОБЯЗАТЕЛЬНОЕ ДОКУМЕНТИРОВАНИЕ ПОСЛЕ ПРИЁМКИ:

**После успешного завершения этапа работы ВСЕГДА:**
1. Обновить `Changelog.md` — зафиксировать все изменения этапа
2. Обновить `docs/Roadmap_GraphRAG.md` — отметить выполненные пункты
3. Обновить `README.md` — если добавлены новые возможности/команды
4. Проверить `.cursor/rules/` — актуализировать правила если нужно

**Это правило НЕ опционально — документирование = часть приёмки!**

#### ЧТО НЕ ДОКУМЕНТИРОВАТЬ В CHANGELOG:
**ЗАПРЕЩЕНО добавлять записи о результатах обработки конкретных документов:**
- Названия обработанных документов (конфиденциальны)
- Результаты обработки (созданные BPMN, RACI, Pipeline)
- Содержимое документов (бизнес-процессы клиентов)
- Статистика обработки конкретных файлов

**Причина:** Репозиторий ПУБЛИЧНЫЙ, документы клиентов КОНФИДЕНЦИАЛЬНЫ.

**Документировать ТОЛЬКО:**
- Изменения кода (новые функции, исправления, оптимизации)
- Изменения архитектуры (новые модули, рефакторинг)
- Изменения документации (README, правила, docs/)
- Изменения конфигурации (requirements.txt, .gitignore)
- Добавление/удаление зависимостей

## Главное правило: AS-IS моделирование

**По умолчанию ВСЕ схемы создаются строго AS-IS (как есть в документе)!**

**КАТЕГОРИЧЕСКИ ЗАПРЕЩЕНО:**
- Добавлять связи, которых НЕТ в исходном документе
- "Додумывать" логику процесса по аналогии или здравому смыслу
- Создавать элементы (Task, Gateway, Flow) без ссылки на пункт документа
- Предполагать связи между процессами, если они явно не описаны
- Упрощать или оптимизировать процесс (это задача TO-BE, не AS-IS)

**ОБЯЗАТЕЛЬНО:**
- Каждый элемент = конкретный пункт документа
- Каждая связь = явное описание в документе
- Если связь неочевидна -> спросить пользователя, а не додумывать
- Если в документе противоречие -> зафиксировать и уточнить

## Краткий список основных запретов

### BPMN Диаграммы:
1. НЕ создавать BPMN файлы без секции `bpmndi:BPMNDiagram`
2. НЕ создавать элементы без визуальных координат (BPMNShape/BPMNEdge)
3. НЕ дублировать закрывающие теги в XML
4. НЕ создавать SubProcess без lanes (минимум 1 lane обязательна)
5. НЕ игнорировать ошибки парсинга из Camunda Modeler

### Работа с файлами:
6. НЕ удалять исходные файлы из `input/` без явного запроса
7. НЕ перезаписывать рабочие файлы без создания резервной копии в `archive/`

### Документация:
8. ОБЯЗАТЕЛЬНО добавлять `<bpmn:documentation>` с трассировкой к источнику
9. НЕ писать длинные описания в `<bpmn:documentation>` (1-3 предложения, детали в MD)

**Детальные правила с примерами:** см. `40_bpmn_technical.mdc`

## Обработка ошибок

- **Запрещено использовать `try/except` для тихого скрытия ошибок.**
- Явные проверки и понятные сообщения; альтернативы обсуждаем.
- **Запрещено подменять факты рассуждениями** — выводы опираются на проверяемые данные/артефакты.
- Запрещено создавать фейковые файлы/результаты и использовать хардкод (кроме локальной отладки с тестами).
- **Запрещено подменять алгоритмическую логику хардкодом** — все значения должны быть фактическими.
- **Запрещено удалять файлы/каталоги/таблицы без явного подтверждения человека.**

## Экспертный уровень анализа

### Процесс анализа
1. **Читать полный контекст** — архитектурные документы, код, инварианты.
2. **Определить ключевые предположения** — что обязательно должно быть верно.
3. **Проверить граничные случаи** — нулевые значения, экстремальные ситуации, конфликты.
4. **Перепроверить логику** — особенно для систем с взаимодействиями.
5. **Скептичный взгляд** — предположить наихудший сценарий для собственного решения.

### Признание ошибок
- При обнаружении ошибки в собственной диагностике: полное признание, исправление, объяснение урока.
- Каждая ошибка — улучшение процесса анализа для будущих задач.
